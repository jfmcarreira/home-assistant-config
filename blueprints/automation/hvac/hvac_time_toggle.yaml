blueprint:
  name: "[HVAC] Controlo Horário do Ar Condicionado"
  description: Ligar/Desligar Ar condicionado a uma determinada hora

  domain: automation
  input:
    schedule:
      name: Horário
      description: Horário da acção
      selector:
        time:

    schedule_weekend:
      name: Horário (Fim de Semana)
      description: Horário da acção durante o fim de semana
      selector:
        time:

    hvac_unit:
      name: Unidade a Controlar
      selector:
        entity:
          domain: climate

    hvac_action:
      name: Acção
      selector:
        select:
          options:
            - label: Ligar
              value: action_on
            - label: Desligar
              value: action_off

mode: restart
max_exceeded: silent

variables:
  hvac_action: !input hvac_action

trigger:
  - platform: time
    id: normal_time
    at: !input schedule

  - platform: time
    id: weekend_time
    at: !input schedule_weekend

condition:
  - condition: state
    entity_id: !input hvac_unit
    state:
      - "heat"
      - "cool"

  - condition: or
    conditions:
      - condition: state
        entity_id: binary_sensor.workday_tomorrow
        state: "on"
      - condition: trigger
        id:
          - weekend_time

action:
  - if:
      - condition: template
        value_template: >
          {{ hvac_action == "action_on" }}
    then:
      - service: climate.turn_on
        target:
          entity_id: !input hvac_unit
      - stop:

  - if:
      - condition: template
        value_template: >
          {{ hvac_action == "action_off" }}
    then:
      - service: climate.turn_off
        target:
          entity_id: !input hvac_unit
      - stop:
