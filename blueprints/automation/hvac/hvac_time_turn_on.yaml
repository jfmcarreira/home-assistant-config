blueprint:
  name: "[HVAC] Controlo Horário - Ligar Ar Condicionado"
  description: Ligar Ar condicionado a uma determinada hora

  domain: automation
  input:
    hvac_unit:
      name: Unidade a Controlar
      selector:
        entity:
          domain: climate

    schedule_start:
      name: Horário de ínicio de controlo
      description: Horário da acção
      selector:
        time:

    schedule_end:
      name: Horário de fim de controlo
      description: Horário da acção
      selector:
        time:

    weekday:
      name: Dia da Semana
      default: [mon, tue, wed, thu, fri, sat, sun]
      selector:
        select:
          options:
            - label: Segunda-feira
              value: mon
            - label: Terça-feira
              value: tue
            - label: Quarta-feira
              value: wed
            - label: Quinta-feira
              value: thu
            - label: Sexta-feira
              value: fri
            - label: Sábado
              value: sat
            - label: Domingo
              value: sun
          custom_value: false
          multiple: true

    hvac_temperature:
      name: Temperatura do AC
      default: 20
      selector:
        number:
          min: 18
          max: 25

    extra_hvac_actions:
      name: Acções Extra
      default: []
      selector:
        action:

    hvac_delayed_temperature_offset:
      name: Temperatura do AC Após 1h
      default: 0
      selector:
        number:
          mode: box
          min: -2
          max: +2

    temperature_sensor:
      name: Sensor de Temperatura
      default:
      selector:
        entity:
          domain: sensor
          device_class: temperature

    room_temperature:
      name: Temperatura da Divisão
      default: 20
      selector:
        number:
          min: 18
          max: 25
          step: 0.1
          unit_of_measurement: "ºC"

    selected_season:
      name: Estação do Ano
      default: [spring, summer, autumn, winter]
      selector:
        select:
          options:
            - label: Primavera
              value: spring
            - label: Verão
              value: summer
            - label: Outono
              value: autumn
            - label: Inverno
              value: winter
          custom_value: false
          multiple: true

mode: restart
max_exceeded: silent

variables:
  hvac_temperature: !input hvac_temperature
  hvac_delayed_temperature_offset: !input hvac_delayed_temperature_offset

trigger:
  - trigger: time
    id: normal_time
    at: !input schedule_start

  - trigger: time
    id: normal_time
    at: !input schedule_end

  - trigger: numeric_state
    entity_id: !input temperature_sensor
    below: !input room_temperature

  - trigger: numeric_state
    entity_id: !input temperature_sensor
    above: !input room_temperature

condition:
  - condition: state
    entity_id: !input hvac_unit
    state:
      - "off"

  - condition: state
    entity_id: sensor.season
    state: !input "selected_season"

  - condition: time
    after: !input schedule_start
    before: !input schedule_end

  - condition: time
    weekday: !input "weekday"

  - condition: numeric_state
    entity_id: !input temperature_sensor
    below: !input room_temperature

action:
  - action: climate.set_hvac_mode
    target:
      entity_id: !input hvac_unit
    data:
      hvac_mode: heat

  - action: climate.set_temperature
    target:
      entity_id: !input hvac_unit
    data:
      temperature: !input hvac_temperature

  - sequence: !input extra_hvac_actions

  - condition: template
    value_template: "{{ (hvac_delayed_temperature_offset | int | abs) > 0  }}"

  - delay:
      hours: 1

  - action: climate.set_temperature
    target:
      entity_id: !input hvac_unit
    data:
      temperature: "{{ hvac_temperature + hvac_delayed_temperature_offset }}"
