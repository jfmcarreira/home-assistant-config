binary_sensor:
  - platform: template
    sensors:
      wash_machine_dry_clothes:
        entity_id:
          - sensor.grocy_chores
        value_template: >
          {{ ( as_timestamp( state_attr('sensor.grocy_chores', 'items')[4]._last_tracked_time ) - as_timestamp( state_attr('sensor.grocy_chores', 'items')[2]._last_tracked_time ) ) < 0 }}
        attribute_templates:
          last_done: >
            {{ state_attr('sensor.grocy_chores', 'items')[4]._last_tracked_time | timestamp_custom("%Y-%m-%d %H:%M:%S", true) }}

      wash_machine_wet_clothes:
        entity_id:
          - sensor.grocy_chores
        value_template: >
          {{ ( as_timestamp( state_attr('sensor.grocy_chores', 'items')[2]._last_tracked_time ) - as_timestamp( state_attr('sensor.grocy_chores', 'items')[3]._last_tracked_time ) ) < 0 }}
        attribute_templates:
          last_done: >
            {{ state_attr('sensor.grocy_chores', 'items')[2]._last_tracked_time | timestamp_custom("%Y-%m-%d %H:%M:%S", true) }}

automation old:
  - id: Task Laundry Remove From Wash Machine
    alias: Task Laundry Remove From Wash Machine
    trigger:
      - entity_id: binary_sensor.washing_machine_state
        from: "on"
        platform: state
        to: "off"
    condition: []
    action:
      - service: grocy.execute_chore
        data_template:
          chore_id: 5
          tracked_time: >
            {{ now() }}

      - service: notify.mobile_app_all
        data:
          title: Tarefa Doméstica
          message: Retirar roupa da máquina de lavar
          data:
            sticky: true
            tag: laundry_wet_clothes_notification
