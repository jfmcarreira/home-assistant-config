<<: !include shelly25_base.yml

light:
  - id: light_1
    name: ${Light_A_Name}
    platform: binary
    output: relay_1
    restore_mode: RESTORE_DEFAULT_OFF
  - id: light_2
    name: ${Light_B_Name}
    platform: binary
    output: relay_2
    restore_mode: RESTORE_DEFAULT_OFF

globals:
  - id: time_lights_on_mins
    type: int
    restore_value: no
    initial_value: "0"

# time:
#   - platform: homeassistant
#     id: homeassistant_time
#     # count time in enabled state every minute
#     on_time:
#       - seconds: 0
#         minutes: /1
#         then:
#           - lambda: |-
#               if (id(light_1).state || id(light_2).state) {
#                 id(time_lights_on_mins) += 1;
#               }

binary_sensor:
  - id: sw_1
    platform: gpio
    pin: ${InputAPin}
    on_multi_click:
      - timing:
          - ON for at most 1000ms
          - OFF for at least 100ms
        invalid_cooldown: 100ms
        then:
          - if:
              condition:
                and:
                  - light.is_on: light_1
                  - light.is_on: light_2
              then:
                - light.turn_off: light_1
                - light.turn_off: light_2
              else:
                - light.toggle: light_1
          - globals.set:
              id: time_lights_on_mins
              value: "0"
      - timing:
          - ON for at least 1000ms
        invalid_cooldown: 100ms
        then:
          - logger.log: "Long 1 Press"
          - homeassistant.service:
              service: homeassistant.toggle
              data:
                entity_id: ${Fan}

  - id: sw_2
    platform: gpio
    pin: ${InputBPin}
    on_multi_click:
      - timing:
          - ON for at most 1000ms
          - OFF for at least 100ms
        invalid_cooldown: 100ms
        then:
          - if:
              condition:
                and:
                  - light.is_on: light_1
                  - light.is_on: light_2
              then:
                - light.turn_off: light_1
                - light.turn_off: light_2
              else:
                - light.toggle: light_2
          - globals.set:
              id: time_lights_on_mins
              value: "0"