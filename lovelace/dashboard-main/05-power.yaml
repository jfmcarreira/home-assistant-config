icon: "mdi:flash"
path: power
title: Power
panel: true
cards:
  - type: "custom:layout-card"
    layout: horizontal
    max_columns: 4
    cards:
      - type: "custom:vertical-stack-in-card"
        title: Potência Instantânea
        cards:
          - entity: sensor.bhpzem_power
            max: 3400
            min: 0
            name: Potência
            type: gauge
          - entities:
              - entity: sensor.bhpzem_voltage
              - entity: sensor.bhpzem_current
              - entity: sensor.bhpzem_pf
              - entity: sensor.bhpzem_frequency
            show_icon: false
            type: glance
          - entities:
              - entity: sensor.bhpzem_power
            height: 150
            hours_to_show: 24
            line_width: 1
            name: Últimas 24 Horas
            points_per_hour: 10
            show:
              average: false
              extrema: true
              graph: line
              labels_secondary: false
              points: hover
              state: true
            type: "custom:mini-graph-card"
            
          - type: entities
            title: Facturação
            show_header_toggle: false
            entities:
              - entity: sensor.daily_energy
                name: Consumo Diário
              - entity: sensor.monthly_energy
                name: Facturação Consumo
              - entity: sensor.monthly_energy_cost
                name: Facturação Preço
        
        
        
     

      - type: "custom:vertical-stack-in-card"
        cards:
          - type: entities
            title: Consumos
            entities:
              - type: 'custom:chartjs-card'
                chart: bar
                custom_options:
                  showLegend: false
                data:
                  datasets:
                    - backgroundColor: '${states["sensor.query_daily_energy_current_month"].attributes.colors}'
                      borderWidth: 1
                      data: '${states["sensor.query_daily_energy_current_month"].attributes.data}'
                      label: Eletricidade
                    
                  labels: '${states["sensor.query_daily_energy_current_month"].attributes.labels}'
                entity_row: true
                options:
                  scales:
                    yAxes:
                      - ticks:
                          beginAtZero: true
                  title:
                    display: false
                    text: Consumo Energético Mês Corrente
                    
              - type: 'custom:chartjs-card'
                chart: doughnut
                entity_row: true
                data:
                  datasets:
                    - data:
                        - '${states["sensor.query_month_energy_living_room"].state}'
                        - '${states["sensor.query_month_energy_laundry"].state}'
                        - '${states["sensor.query_month_energy_dish_wash_machine"].state}'
                        - '${states["sensor.query_month_energy_fridge"].state}'
                        - '${states["sensor.query_month_energy_iron"].state}'
                        - '${states["sensor.query_month_energy_office_desk"].state}'
                        - '${states["sensor.query_month_energy_lights"].state}'
                        - '${states["sensor.query_month_energy_remaining"].state}'
                      backgroundColor:                        
                        - '#003f5c'
                        - '#2f4b7c'
                        - '#665191'
                        - '#a05195'
                        - '#d45087'
                        - '#f95d6a'
                        - '#ff7c43'
                        - '#ffa600'
                      borderColor: 
                        - var(--secondary-background-color)
                        - var(--secondary-background-color)
                        - var(--secondary-background-color)
                        - var(--secondary-background-color)
                        - var(--secondary-background-color)
                        - var(--secondary-background-color)
                        - var(--secondary-background-color)
                        - var(--secondary-background-color)
                  labels:
                    - Centro Multimédia
                    - Lavandaria 
                    - Máq. lavar loiça
                    - Frigorifico
                    - Ferro de Engomar
                    - Secretária
                    - Iluminação
                    - Outros
                options:
                  legend:
                    position: left
                  #title:
                    #display: true
                    #text: Consumo energético (hoje)
              
                    
              #- type: 'custom:chartjs-card'
                #chart: bar
                #custom_options:
                  #showLegend: false
                #data:
                  #datasets:
                    ##- label: Total
                      ##borderWidth: 1
                      ##data: '${states["sensor.query_daily_energy_current_month"].attributes.data}'
                      ##backgroundColor: var(--accent-color)
                    
                    #- label: Centro Multimédia
                      #borderWidth: 1
                      #data: '${states["sensor.query_daily_energy_living_room"].attributes.data}'
                      #backgroundColor: var(--accent-color)
                      
                    #- label: Lavandaria
                      #borderWidth: 1
                      #data: '${states["sensor.query_daily_energy_laundry"].attributes.data}'
                      #backgroundColor: var(--accent-color)
                      
                    #- label: Frigorífico
                      #borderWidth: 1
                      #data: '${states["sensor.query_daily_energy_fridge"].attributes.data}'
                      #backgroundColor: var(--accent-color)
                      
                    #- label: Máquina de Lavar Loiça
                      #borderWidth: 1
                      #data: '${states["sensor.daily_energy_dish_wash_machine"].attributes.data}'
                      #backgroundColor: var(--accent-color)
                      
                    #- label: Ferro/AP
                      #borderWidth: 1
                      #data: '${states["sensor.query_daily_energy_iron"].attributes.data}'
                      #backgroundColor: var(--accent-color)
                    
                    #- label: Secretária Escritório
                      #borderWidth: 1
                      #data: '${states["sensor.query_daily_energy_office_desk"].attributes.data}'
                      #backgroundColor: var(--accent-color)
                      
                    #- label: Outros
                      #borderWidth: 1
                      #data: '${states["sensor.query_daily_energy_remaining"].attributes.data}'
                      #backgroundColor: var(--accent-color)

                  #labels: '${states["sensor.query_daily_energy_living_room"].attributes.labels}'
                #entity_row: true
                #options:
                  #scales:
                    #yAxes:
                      #- ticks:
                          #beginAtZero: true
                  #title:
                    #display: false
                    #text: Consumo Energético Mês Corrente
              
              - type: 'custom:chartjs-card'
                chart: bar
                custom_options:
                  showLegend: false
                data:
                  datasets:
                    - backgroundColor: var(--accent-color)
                      borderWidth: 1
                      data: '${states["sensor.query_month_energy_current_year"].attributes.data}'
                      label: Eletricidade
                  labels: '${states["sensor.query_month_energy_current_year"].attributes.labels}'
                entity_row: true
                options:
                  scales:
                    yAxes:
                      - ticks:
                          beginAtZero: true
                  title:
                    display: false
                    text: Consumo energético (últimos 12 meses)
              
      - type: vertical-stack
        cards:
        - card:
            show_header_toggle: false
            title: Potência Divisões
            type: entities
          filter:
            include:
              - entity_id: sensor.power_sensor_*
          show_empty: false
          sort:
            ignore_case: true
            method: entity_id
          type: "custom:auto-entities"
        - card:
            show_header_toggle: false
            title: Potência Dispositivos
            type: entities
          filter:
            include:
              #- entity_id: sensor.power_usage_*
              - entity_id: sensor.power_usage_device*
          show_empty: false
          type: "custom:auto-entities"
        - card:
            show_header_toggle: false
            title: Potência Dispositivos
            type: entities
          filter:
            include:
              - entity_id: sensor.power_usage_light*
          show_empty: false
          type: "custom:auto-entities"

    

      - type: "custom:vertical-stack-in-card"
        title: Utilidades
        cards:
          - type: entities
            show_header_toggle: false
            title: Electricidade
            entities:
              - entity: sensor.electricity_last_meter
                name: Última Contagem
              - entity: sensor.electricity_meter
                name: Contagem Total
              - entity: input_number.electricity_meter_offpeak
                name: Contagem Vazio
              - entity: input_number.electricity_meter_peak
                name: Contagem Pontas
              - entity: input_number.electricity_meter_full
                name: Contagem Cheias
            
            
          - type: entities
            show_header_toggle: false
            title: Gás
            entities:
              - entity: sensor.gas_last_meter
                name: Última Contagem
              - entity: input_number.gas_meter
                name: Contagem Gás
            
            
  
          - entities:
              - entity: sensor.water_last_meter
                name: Última Contagem
              - entity: input_number.water_meter
                name: Contagem Água
            show_header_toggle: false
            title: Água
            type: entities
        
      
 
