[{"id":"db81865e.1b9518","type":"tab","label":"PresenceDetection","disabled":false,"info":""},{"id":"8dc7985d.16bdc8","type":"tab","label":"Heating","disabled":true,"info":""},{"id":"b430708b.f3f62","type":"mqtt-broker","name":"Main","broker":"10.20.30.119","port":"1883","clientid":"","usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"80cf2236.b57b3","type":"nora-config","name":"Nora-GHome","group":"","notify":false},{"id":"ac9284b7.41b378","type":"server","name":"Home Assistant","legacy":false,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true},{"id":"a00ba9cc.0db1c8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"a7fdf8bd.c349e8","type":"server-state-changed","z":"db81865e.1b9518","name":"Joao Home","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.joao_home","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":40,"wires":[[],["8e840c2b.85dbe"]]},{"id":"ae3da074.08599","type":"api-current-state","z":"db81865e.1b9518","name":"Joao Home","server":"ac9284b7.41b378","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.joao_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":510,"y":40,"wires":[[],["59dca581.e5ee3c"]]},{"id":"5b530c46.6b8d94","type":"server-state-changed","z":"db81865e.1b9518","name":"Bianca Home","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bianca_home","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"true","halt_if_type":"bool","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":100,"wires":[[],["8e840c2b.85dbe"]]},{"id":"8e840c2b.85dbe","type":"api-current-state","z":"db81865e.1b9518","name":"Bianca Home","server":"ac9284b7.41b378","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"binary_sensor.bianca_home","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":320,"y":40,"wires":[[],["ae3da074.08599"]]},{"id":"59dca581.e5ee3c","type":"api-current-state","z":"db81865e.1b9518","name":"House Guests","server":"ac9284b7.41b378","version":1,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"input_boolean.house_guest","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":700,"y":40,"wires":[[],["4873665e.64b2a8"]]},{"id":"4873665e.64b2a8","type":"api-call-service","z":"db81865e.1b9518","name":"House Not Occupied","server":"ac9284b7.41b378","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_off","entityId":"input_boolean.notify_home","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":940,"y":40,"wires":[[]]},{"id":"bdc87701.65c3e8","type":"api-call-service","z":"db81865e.1b9518","name":"House Occupied","server":"ac9284b7.41b378","version":1,"debugenabled":false,"service_domain":"input_boolean","service":"turn_on","entityId":"input_boolean.notify_home","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":370,"y":240,"wires":[[]]},{"id":"9da05189.022a8","type":"server-state-changed","z":"db81865e.1b9518","name":"Joao Home","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.joao_home","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":240,"wires":[["bdc87701.65c3e8"],[]]},{"id":"c02500f0.f1482","type":"server-state-changed","z":"db81865e.1b9518","name":"Bianca Home","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.bianca_home","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":300,"wires":[["bdc87701.65c3e8"],[]]},{"id":"7152bff.3ade74","type":"server-state-changed","z":"db81865e.1b9518","name":"House Guest","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.house_guest","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":360,"wires":[["bdc87701.65c3e8"],[]]},{"id":"fc1a1d2c.513d6","type":"server-state-changed","z":"db81865e.1b9518","name":"House Guest","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.house_guest","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":110,"y":160,"wires":[[],["8e840c2b.85dbe"]]},{"id":"d409e84c.781fa8","type":"server-state-changed","z":"8dc7985d.16bdc8","name":"","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sonoff_basic_heating_switch","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"x":237,"y":124,"wires":[["14c7a465.7538fc"],[]]},{"id":"454e5328.52b0ac","type":"api-call-service","z":"8dc7985d.16bdc8","name":"","server":"ac9284b7.41b378","version":1,"debugenabled":false,"service_domain":"climate","service":"turn_on","entityId":"climate.heating","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":160,"wires":[[]]},{"id":"c23bb33c.37bec","type":"api-call-service","z":"8dc7985d.16bdc8","name":"","server":"ac9284b7.41b378","version":1,"debugenabled":false,"service_domain":"climate","service":"turn_off","entityId":"climate.heating","data":"","dataType":"json","mergecontext":"","output_location":"","output_location_type":"none","mustacheAltTags":false,"x":920,"y":100,"wires":[[]]},{"id":"14c7a465.7538fc","type":"api-current-state","z":"8dc7985d.16bdc8","name":"","server":"ac9284b7.41b378","version":1,"outputs":2,"halt_if":"heat","halt_if_type":"str","halt_if_compare":"is","override_topic":false,"entity_id":"climate.heating","state_type":"str","state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","blockInputOverrides":false,"x":597,"y":124,"wires":[["c23bb33c.37bec"],["454e5328.52b0ac"]]},{"id":"71107ed3.f3cd78","type":"server-state-changed","z":"db81865e.1b9518","name":"","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.ble_scanner_office","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":200,"y":460,"wires":[["6c47031c.ebc08c"]]},{"id":"6c47031c.ebc08c","type":"json","z":"db81865e.1b9518","name":"","property":"payload","action":"","pretty":false,"x":610,"y":460,"wires":[["5ee35b44.f3e3dc"]]},{"id":"98cd291e.ca33e","type":"mqtt out","z":"db81865e.1b9518","name":"","topic":"home-assistant/location/joao_amazfit","qos":"","retain":"","broker":"b430708b.f3f62","x":810,"y":820,"wires":[]},{"id":"9c6fe2e6.afae1","type":"server-state-changed","z":"db81865e.1b9518","name":"","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.amazfit_joao","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":180,"y":820,"wires":[["d0d9749a.e27c98"]]},{"id":"7520599e.a33778","type":"mqtt out","z":"db81865e.1b9518","name":"","topic":"home-assistant/location/bianca_amazfit","qos":"","retain":"","broker":"b430708b.f3f62","x":820,"y":880,"wires":[]},{"id":"8c8b4d38.91b57","type":"server-state-changed","z":"db81865e.1b9518","name":"","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.amazfit_bianca","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":190,"y":880,"wires":[["6a0245c9.14f984"]]},{"id":"48c7003d.012df","type":"mqtt out","z":"db81865e.1b9518","name":"","topic":"room_presence/office","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"b430708b.f3f62","x":1580,"y":580,"wires":[]},{"id":"9f953994.9cae58","type":"server-state-changed","z":"db81865e.1b9518","name":"","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.ble_scanner_living_room","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":220,"y":520,"wires":[["f984c36d.ffb8c8"]]},{"id":"f984c36d.ffb8c8","type":"json","z":"db81865e.1b9518","name":"","property":"payload","action":"","pretty":false,"x":610,"y":520,"wires":[["387e778c.ea6fa8"]]},{"id":"a4adb7f7.244ec8","type":"switch","z":"db81865e.1b9518","name":"","property":"payload.address","propertyType":"msg","rules":[{"t":"eq","v":"EC:BF:F8:8F:0E:9B","vt":"str"},{"t":"eq","v":"FD:2A:F9:0D:8B:BB","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":970,"y":580,"wires":[["ecc310d1.6349"],["f9ba47c8.625e68"]]},{"id":"720e873a.33031","type":"mqtt out","z":"db81865e.1b9518","name":"","topic":"room_presence/living_room","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"b430708b.f3f62","x":1640,"y":640,"wires":[]},{"id":"d0d9749a.e27c98","type":"function","z":"db81865e.1b9518","name":"Map Room","func":"if (msg.payload == \"office\") {\n  msg.payload = \"Escritório\";\n} else if (msg.payload == \"living_room\") {\n  msg.payload = \"Sala de Estar\";\n} else if (msg.payload == \"master_bedroom\") {\n  msg.payload = \"Quarto Principal\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":820,"wires":[["98cd291e.ca33e"]]},{"id":"2245059b.1d604a","type":"function","z":"db81865e.1b9518","name":"Calculate Distance","func":"var txPower = -72\n\nvar ratio = msg.payload.rssi * 1.0 / txPower\n\nif (ratio < 1.0) {\n  distFl = Math.pow(ratio, 10);\n} else {\n  distFl = (0.89976) * Math.pow(ratio, 7.7095) + 0.111;\n}\nmsg.payload.distance = Math.round(distFl * 100) / 100;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":970,"y":520,"wires":[["a4adb7f7.244ec8"]]},{"id":"387e778c.ea6fa8","type":"function","z":"db81865e.1b9518","name":"","func":"msg.payload.room = \"living_room\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":520,"wires":[["2245059b.1d604a"]]},{"id":"ecc310d1.6349","type":"function","z":"db81865e.1b9518","name":"Joao","func":"msg.payload.id = \"amazfit_joao\"\nmsg.payload.name = \"joao\"\nmsg.payload.uuid = \"EC:BF:F8:8F:0E:9B\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":600,"wires":[["b3751546.b1b8b"]]},{"id":"f9ba47c8.625e68","type":"function","z":"db81865e.1b9518","name":"Bianca","func":"msg.payload.id = \"amazfit_bianca\"\nmsg.payload.name = \"bianca\"\nmsg.payload.uuid = \"FD:2A:F9:0D:8B:BB\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":660,"wires":[["b3751546.b1b8b"]]},{"id":"b3751546.b1b8b","type":"switch","z":"db81865e.1b9518","name":"Switch Room","property":"payload.room","propertyType":"msg","rules":[{"t":"eq","v":"office","vt":"str"},{"t":"eq","v":"living_room","vt":"str"},{"t":"eq","v":"master_bedroom","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1350,"y":620,"wires":[["48c7003d.012df"],["720e873a.33031"],["81f02ab3.c9514"]]},{"id":"5ee35b44.f3e3dc","type":"function","z":"db81865e.1b9518","name":"","func":"msg.payload.room = \"office\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":460,"wires":[["2245059b.1d604a"]]},{"id":"c5c688aa.4c8fc8","type":"server-state-changed","z":"db81865e.1b9518","name":"","server":"ac9284b7.41b378","version":1,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.ble_scanner_master_bedroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"x":240,"y":580,"wires":[["104521c8.39b95e"]]},{"id":"104521c8.39b95e","type":"json","z":"db81865e.1b9518","name":"","property":"payload","action":"","pretty":false,"x":610,"y":580,"wires":[["16e859c1.c8cb0e"]]},{"id":"16e859c1.c8cb0e","type":"function","z":"db81865e.1b9518","name":"","func":"msg.payload.room = \"master_bedroom\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":760,"y":580,"wires":[["2245059b.1d604a"]]},{"id":"81f02ab3.c9514","type":"mqtt out","z":"db81865e.1b9518","name":"","topic":"room_presence/master_bedroom","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"b430708b.f3f62","x":1620,"y":700,"wires":[]},{"id":"2f9fd104.093406","type":"mqtt in","z":"db81865e.1b9518","name":"","topic":"room-assistant/sensor/ble-fd2af90d8bbb/attributes","qos":"2","datatype":"auto","broker":"b430708b.f3f62","x":230,"y":740,"wires":[["eb760538.61b6","ba9921dc.8be63"]]},{"id":"eb760538.61b6","type":"json","z":"db81865e.1b9518","name":"","property":"payload","action":"","pretty":false,"x":530,"y":740,"wires":[["d5630c3f.2bf428"]]},{"id":"d5630c3f.2bf428","type":"function","z":"db81865e.1b9518","name":"","func":"msg.payload.room = \"living_room\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":740,"wires":[["f9ba47c8.625e68"]]},{"id":"6debe4c8.2d07f4","type":"mqtt in","z":"db81865e.1b9518","name":"","topic":"room-assistant/sensor/ble-ecbff88f0e9b/attributes","qos":"2","datatype":"auto","broker":"b430708b.f3f62","x":220,"y":680,"wires":[["983ae959.a5fb08","ba9921dc.8be63"]]},{"id":"983ae959.a5fb08","type":"json","z":"db81865e.1b9518","name":"","property":"payload","action":"","pretty":false,"x":530,"y":680,"wires":[["95a8e431.d0c2a8"]]},{"id":"95a8e431.d0c2a8","type":"function","z":"db81865e.1b9518","name":"","func":"msg.payload.room = \"living_room\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":680,"wires":[["ecc310d1.6349"]]},{"id":"6a0245c9.14f984","type":"function","z":"db81865e.1b9518","name":"Map Room","func":"if (msg.payload == \"office\") {\n  msg.payload = \"Escritório\";\n} else if (msg.payload == \"living_room\") {\n  msg.payload = \"Sala de Estar\";\n} else if (msg.payload == \"master_bedroom\") {\n  msg.payload = \"Quarto Principal\";\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":880,"wires":[["7520599e.a33778"]]},{"id":"ba9921dc.8be63","type":"debug","z":"db81865e.1b9518","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1180,"y":760,"wires":[]}]