script:   
  play_tts_announcement:
    alias: Reproduzir Mensagem num Smart Speaker
    fields:
      media_player_for_tts:
        description: 'Media player'
        example: 'media_player.ghm_office'
      message_to_play:
        description: "Message to play"
        example: "Hello"
      message_duration:
        description: "Duration of the message"
        example: "30"
    variables:
      current_volume: 0.1
    sequence:
      - service: media_player.turn_on
        data:
          entity_id: "{{ media_player_for_tts }}"
      
      - wait_template: "{{ is_state( media_player_for_tts , 'off' )  == False }}"
      
      - variables:
          current_volume: "{{ state_attr( media_player_for_tts, 'volume_level' ) }}"
      
      - service: media_player.media_pause
        data:
          entity_id:  "{{ media_player_for_tts }}"
        
      - service: media_player.volume_set
        data:
          entity_id: "{{ media_player_for_tts }}"
          volume_level: 0.2
      
      - delay: 00:00:01
      
      - service: tts.polly_say
        data:
          entity_id: "{{ media_player_for_tts }}"
          message: "{{ message_to_play }}"
    
      
      - delay: "{{ message_duration }}"
      
      - service: media_player.volume_set
        data:
          entity_id: "{{ media_player_for_tts }}"
          volume_level: "{{ current_volume }}"
