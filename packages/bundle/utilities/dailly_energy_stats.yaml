automation insert:
  - alias: "Daily Stats Insert Value of Energy to Database"
    initial_state: true
    mode: queued
    max: 10
    trigger:
      - platform: state
        entity_id: sensor.daily_energy
    action:
      - service: shell_command.external_my_sql_insert
        data_template:
          table: daily_energy
          value: >
            {{ states.sensor.daily_energy.state }}
            
            
  - alias: "Daily Stats Insert Value of Partial Energy of to Database"
    initial_state: true
    mode: queued
    max: 10
    trigger:
      - platform: state
        entity_id: sensor.daily_energy_living_room
      - platform: state
        entity_id: sensor.daily_energy_laundry
      - platform: state
        entity_id: sensor.daily_energy_dish_wash_machine
      - platform: state
        entity_id: sensor.daily_energy_fridge
      - platform: state
        entity_id: sensor.daily_energy_office_desk
      - platform: state
        entity_id: sensor.daily_energy_iron
    action:
      - service: shell_command.external_my_sql_insert
        data_template:
          table: daily_energy_partial
          value: >
            {{ trigger.to_state.state }}
          column: >
            {% if trigger.entity_id == "sensor.daily_energy_living_room" %}
              daily_energy_living_room
            {% elif trigger.entity_id == "sensor.daily_energy_laundry" %}
              daily_energy_laundry
            {% elif trigger.entity_id == "sensor.daily_energy_dish_wash_machine" %}
              daily_energy_dish_wash_machine
            {% elif trigger.entity_id == "sensor.daily_energy_fridge" %}
              daily_energy_fridge
            {% elif trigger.entity_id == "sensor.daily_energy_office_desk" %}
              daily_energy_office_desk
            {% elif trigger.entity_id == "sensor.daily_energy_iron" %}
              daily_energy_iron
            {% elif trigger.entity_id == "sensor.daily_energy_remaining" %}
              daily_energy_remaining
            {% endif %}

            
            
sensor:
  - platform: sql
    db_url: !secret db_custom_url
    queries:
      - name: query_daily_energy_current_month
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(value SEPARATOR ','),']') AS data,
              CONCAT('["', GROUP_CONCAT(IF(`value` > 10, 'red', IF(`value` > 7, 'orange', 'green')) SEPARATOR '","'),'"]') AS colors,
              ROUND(SUM(value), 2) AS total,
              'info in attributes' AS value
          FROM daily_energy
          WHERE MONTH(date) = MONTH(CURRENT_DATE);
        
      - name: query_daily_energy_current_year
        column: "attributes"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              'info in attributes' AS 'attributes'
          FROM
          (
            SELECT
              ROUND(SUM(`value`), 2) AS total,
              CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            FROM `daily_energy`
            GROUP BY MONTH(date)
            ORDER BY date
            LIMIT 12
          ) AS json;
          
          
          
          
      - name: query_daily_energy_living_room
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(daily_energy_living_room SEPARATOR ','),']') AS data,
              'info in attributes' AS value
          FROM daily_energy_partial
          WHERE MONTH(date) = MONTH(CURRENT_DATE);
      
      - name: query_daily_energy_laundry
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(daily_energy_laundry SEPARATOR ','),']') AS data,
              'info in attributes' AS value
          FROM daily_energy_partial
          WHERE MONTH(date) = MONTH(CURRENT_DATE);
          
      - name: query_daily_energy_dish_wash_machine
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(daily_energy_dish_wash_machine SEPARATOR ','),']') AS data,
              'info in attributes' AS value
          FROM daily_energy_partial
          WHERE MONTH(date) = MONTH(CURRENT_DATE);
      
      - name: query_daily_energy_fridge
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(daily_energy_fridge SEPARATOR ','),']') AS data,
              'info in attributes' AS value
          FROM daily_energy_partial
          WHERE MONTH(date) = MONTH(CURRENT_DATE);
          
      - name: query_daily_energy_office_desk
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(daily_energy_office_desk SEPARATOR ','),']') AS data,
              'info in attributes' AS value
          FROM daily_energy_partial
          WHERE MONTH(date) = MONTH(CURRENT_DATE);
      
      - name: query_daily_energy_iron
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(daily_energy_iron SEPARATOR ','),']') AS data,
              'info in attributes' AS value
          FROM daily_energy_partial
          WHERE MONTH(date) = MONTH(CURRENT_DATE);
      
      - name: query_daily_energy_remaining
        column: "value"
        query: >-
          SELECT
              CONCAT('[', GROUP_CONCAT(DAY(date) SEPARATOR ','),']') AS labels,
              CONCAT('[', GROUP_CONCAT(daily_energy_remaining SEPARATOR ','),']') AS data,
              'info in attributes' AS value
          FROM daily_energy_partial
          WHERE MONTH(date) = MONTH(CURRENT_DATE);

          
      #- name: query_daily_energy_living_room
        #column: "value"
        #query: >-
          #SELECT
              #CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              #CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              #'info in attributes' AS 'attributes'
          #FROM
          #(
            #SELECT
              #ROUND(SUM(`daily_energy_living_room`), 2) AS total,
              #CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            #FROM `daily_energy`
            #GROUP BY MONTH(date)
            #ORDER BY date
            #LIMIT 12
          #) AS json;
      
      #- name: query_daily_energy_laundry
        #column: "value"
        #query: >-
          #SELECT
              #CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              #CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              #'info in attributes' AS 'attributes'
          #FROM
          #(
            #SELECT
              #ROUND(SUM(`daily_energy_laundry`), 2) AS total,
              #CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            #FROM `daily_energy`
            #GROUP BY MONTH(date)
            #ORDER BY date
            #LIMIT 12
          #) AS json;
          
      #- name: query_daily_energy_dish_wash_machine
        #column: "value"
        #query: >-
          #SELECT
              #CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              #CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              #'info in attributes' AS 'attributes'
          #FROM
          #(
            #SELECT
              #ROUND(SUM(`daily_energy_dish_wash_machine`), 2) AS total,
              #CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            #FROM `daily_energy`
            #GROUP BY MONTH(date)
            #ORDER BY date
            #LIMIT 12
          #) AS json;
          
      
      #- name: query_daily_energy_fridge
        #column: "value"
        #query: >-
          #SELECT
              #CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              #CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              #'info in attributes' AS 'attributes'
          #FROM
          #(
            #SELECT
              #ROUND(SUM(`daily_energy_fridge`), 2) AS total,
              #CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            #FROM `daily_energy`
            #GROUP BY MONTH(date)
            #ORDER BY date
            #LIMIT 12
          #) AS json;
          
      #- name: query_daily_energy_office_desk
        #column: "value"
        #query: >-
          #SELECT
              #CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              #CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              #'info in attributes' AS 'attributes'
          #FROM
          #(
            #SELECT
              #ROUND(SUM(`daily_energy_office_desk`), 2) AS total,
              #CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            #FROM `daily_energy`
            #GROUP BY MONTH(date)
            #ORDER BY date
            #LIMIT 12
          #) AS json;
          
      #- name: query_daily_energy_iron
        #column: "value"
        #query: >-
          #SELECT
              #CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              #CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              #'info in attributes' AS 'attributes'
          #FROM
          #(
            #SELECT
              #ROUND(SUM(`daily_energy_iron`), 2) AS total,
              #CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            #FROM `daily_energy`
            #GROUP BY MONTH(date)
            #ORDER BY date
            #LIMIT 12
          #) AS json;
      
      #- name: query_daily_energy_remaining
        #column: "value"
        #query: >-
          #SELECT
              #CONCAT('[', GROUP_CONCAT(month SEPARATOR ','), ']') AS labels,
              #CONCAT('[', GROUP_CONCAT(total SEPARATOR ','), ']') AS data,
              #'info in attributes' AS 'attributes'
          #FROM
          #(
            #SELECT
              #ROUND(SUM(`daily_energy_remaining`), 2) AS total,
              #CONCAT('"',MONTHNAME(date), ' ', YEAR(date),'"') AS month
            #FROM `daily_energy`
            #GROUP BY MONTH(date)
            #ORDER BY date
            #LIMIT 12
          #) AS json;
