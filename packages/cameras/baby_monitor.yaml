################################################################
## Reolink E1 Pro Camera
################################################################
input_boolean:
  baby_monitor_high_quality:
    name: Qualidade Baby Monitor
  babyphone_sensor_state:
    name: Estado do Monitor
    initial: "off"

camera:
  - platform: ffmpeg
    name: Baby Monitor
    input: !secret reolinke1pro
    
  - platform: ffmpeg
    name: Baby Monitor Low
    input: !secret reolinke1pro_low

binary_sensor:
  - platform: ffmpeg_noise
    name: Baby Monitor Noise
    input: !secret reolinke1pro_low
#    extra_arguments:
    initial_state: false
    duration: 1
    reset: 30
    peak: -50

  - platform: ffmpeg_motion
    name: Baby Monitor Motion
    input: !secret reolinke1pro_low
    #extra_arguments: -vf "crop=367:190:163:162"
    changes: 30
    initial_state: false

automation:
  - alias: "Change Baby Monitor State"
    trigger:
      - platform: state
        entity_id: input_boolean.babyphone_sensor_state
    action:
      - choose:
          - conditions: "{{ states.input_boolean.babyphone_sensor_state.state == 'on' }}"
            sequence:
              - service: ffmpeg.start
                entity_id: binary_sensor.baby_monitor_motion
              - service: ffmpeg.start
                entity_id: binary_sensor.baby_monitor_noise
        default:
          - service: ffmpeg.stop
            entity_id: binary_sensor.baby_monitor_motion
          - service: ffmpeg.stop
            entity_id: binary_sensor.baby_monitor_noise


#image_processing:
  #- platform: opencv
    #source:
      #- entity_id: camera.baby_monitor_ffmpeg_detector
        #name: Baby Monitor Detector Opencv
    #classifier:
      #face_frontal:
        #file: /config/opencv/haarcascade_frontalface_default.xml
        #neighbors: 2
        #min_size: 
          #- 5
          #- 5
      #face_profile: 
        #file: /config/opencv/haarcascade_profileface.xml
        #neighbors: 2
        #min_size: 
          #- 5
          #- 5
      #upper_body: 
        #file: /config/opencv/haarcascade_upperbody.xml
        #neighbors: 2
        #min_size: 
          #- 5
          #- 5
  
  #- platform: dlib_face_detect
    #source:
      #- entity_id: camera.baby_monitor
        #name: Baby Monitor Detector DLib


#automation:
  #- alias: image_processing_broadcast_audio
    #mode: single
    #trigger:
      #- platform: state
        #entity_id: binary_sensor.baby_monitor_noise
        #from: 'off'
        #to: 'on'
    #action:     
      #- service: camera.play_stream
        #data:
          #entity_id: camera.baby_monitor_ffmpeg
          #media_player: media_player.ghm_office




    
#camera:
  #- platform: reolink_dev
    #host: !secret reolinke1pro_ip
    #username: !secret reolinke1pro_user
    #password: !secret reolinke1pro_pass
    #name: Baby Monitor Reolink
    #stream: main
    #protocol: rtmp
    #scan_interval: 5 

#binary_sensor:
  #- platform: template
    #sensors:
      #motion_baby_monitor:
        #friendly_name:  Baby Monitor
        #device_class: motion
        #value_template: "{{ is_state('camera.baby_monitor_reolink', 'motion') }}"
        #delay_off: 
            #seconds: 15
