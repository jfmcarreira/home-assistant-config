script:
  cover_to_partial_close:
    alias: Colocar Estores a Dois Terços
    fields:
      action_cover:
        name: Cover
        description: Cover to control
        example: cover.kitchen
        selector:
          entity:
            multiple: false
            domain: cover
    variables:
      cover_entitiy: cover.{{ action_cover }}
    sequence:
      - service: cover.set_cover_position
        data:
          position: 66
        target:
          entity_id: "{{ cover_entitiy }}"

  cover_to_partial_open:
    alias: Colocar Estores a Um Terço
    fields:
      action_cover:
        name: Cover
        description: Cover to control
        example: cover.kitchen
        selector:
          entity:
            multiple: false
            domain: cover
    variables:
      cover_entitiy: cover.{{ action_cover }}
    sequence:
      - service: cover.set_cover_position
        data:
          position: 30
        target:
          entity_id: "{{ cover_entitiy }}"

  cover_close_to_when_raining:
    alias: Fechar Estores Durante a Chuva
    fields:
      action_cover:
        name: Cover
        description: Cover to control
        example: cover.kitchen
        selector:
          entity:
            multiple: false
            domain: cover
    variables:
      cover_entitiy: cover.{{ action_cover }}
      cover_position: input_number.cover_rainy_position_{{ action_cover }}
    sequence:
      - condition: template
        value_template:
          "{{ state_attr(cover_entitiy, 'current_position') | float >
          states(cover_position) }}"
      - service: cover.close_cover
        target:
          entity_id: "{{ cover_entitiy }}"
      - wait_template: "{{ is_state(cover_entitiy, 'closed') }}"
      - service: cover.set_cover_position
        data:
          position: "{{ states(cover_position) }}"
        target:
          entity_id: "{{ cover_entitiy }}"

  routine_cover_rain_mode:
    alias: Routina Modo de Chuva
    sequence:
      - service: script.cover_group_action
        data:
          action_to_run: script.cover_close_to_when_raining
          control_switch: close_in_rain
    mode: single
