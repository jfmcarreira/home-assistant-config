script:
  cover_group_action_all:
    alias: Controlo Grupo de Estores
    mode: single
    fields:
      action_to_run:
        description: Service to run on the covers.
        example: cover.open
        required: true
        selector:
          text:
    sequence:
      - service: script.cover_group_action
        data:
          action_to_run: "{{ action_to_run }}"
          control_switch: "group"
          covers_list:
            - living_room
            - stairs
            - bedroom_henrique
            - bedroom_ricardo
            - master_bedroom
            - bathroom
            - bedroom_rc
            - laundry
            - kitchen
            - office

  cover_group_action:
    alias: Controlo Grupo de Estores
    mode: single
    fields:
      covers_list:
        description: List of covers
        example: cover.open
        required: true
        default:
          - living_room
          - kitchen
          - office
          - stairs
          - laundry
          - bathroom
          - bedroom_rc
          - master_bedroom
          - bedroom_ricardo
          - bedroom_henrique
        selector:
          select:
            multiple: true
            mode: list
            options:
              - label: Sala
                value: living_room
              - label: office
                value: office
              - label: Cozinha
                value: kitchen
              - label: Lavandaria
                value: laundry
              - label: Quarto de Arrumos
                value: bedroom_rc
              - label: Casa de Banho
                value: bathroom
              - label: Suite
                value: master_bedroom
              - label: Quarto do Ricardo
                value: bedroom_ricardo
              - label: Quarto do Henrique
                value: bedroom_henrique
              - label: Escadas
                value: stairs
      action_to_run:
        description: Service to run on the covers.
        example: cover.open
        required: true
        selector:
          text:
      control_switch:
        description: Switch name that controls which covers to control
        example: open_sunrise
        required: true
        selector:
          text:
    sequence:
      - repeat:
          for_each: "{{ covers_list }}"
          sequence:
            - condition: "{{ is_state('input_boolean.cover_control_' + control_switch + '_' + repeat.item, 'on') }}"
            - action: select.select_option
              data:
                option: >
                  {% if control_switch == "open_sunrise" %}
                    Sunrise
                  {% elif control_switch == "close_sunset" %}
                    Sunset
                  {% elif control_switch == "close_in_rain" %}
                    Chuva
                  {% elif control_switch == "close_with_heat" %}
                    Sol
                  {% else %}
                    Grupo
                  {% endif %}
              target:
                entity_id: select.cover_{{ repeat.item }}_last_action
            - choose:
                - conditions: "{{ 'script.' in action_to_run }}"
                  sequence:
                    - service: "{{ action_to_run }}"
                      data:
                        action_cover: "{{ repeat.item }}"
              default:
                - service: "{{ action_to_run }}"
                  target:
                    entity_id: "cover.{{ repeat.item }}"
