################################################################
## Power Consumption
################################################################
homeassistant:
  customize_glob:
    "sensor.power_usage_*":
      device_class: power
      icon: mdi:flash
      unit_of_measurement: "W"
    "sensor.power_sensor_*":
      device_class: power
      icon: mdi:flash
      unit_of_measurement: "W"
    "sensor.*_power":
      device_class: power
      icon: mdi:flash
      unit_of_measurement: "W"
    "sensor.power_sensor_*_reactive":
      device_class: power
      icon: mdi:flash-alert
      unit_of_measurement: "VAR"

utility_meter: 
  daily_energy:
    source: sensor.pzem_energy
    cycle: daily
  monthly_energy:
    source: sensor.pzem_energy
    cycle: monthly
    offset:
      days: 19
      
  daily_energy_living_room:
    source: sensor.energy_living_room
    cycle: daily
  daily_energy_laundry:
    source: sensor.energy_laundry
    cycle: daily
  daily_energy_dish_wash_machine:
    source: sensor.energy_dish_wash_machine
    cycle: daily
  daily_energy_fridge:
    source: sensor.energy_fridge
    cycle: daily
  daily_energy_office_desk:
    source: sensor.energy_office_desk
    cycle: daily

sensor energy:
  - platform: integration
    source: sensor.bhpzem_power
    name: pzem_energy
    unit_prefix: k
    round: 2 
  
  - platform: integration
    source: sensor.power_sensor_living_room
    name: energy_living_room
    unit_prefix: k
    round: 2
  
  - platform: integration
    source: sensor.power_sensor_laundry
    name: energy_laundry
    unit_prefix: k
    round: 2 
    
  - platform: integration
    source: sensor.power_usage_dish_wash_machine
    name: energy_dish_wash_machine
    unit_prefix: k
    round: 2 
    
  - platform: integration
    source: sensor.power_usage_fridge
    name: energy_fridge
    unit_prefix: k
    round: 2

  - platform: integration
    source: sensor.power_usage_office_desk
    name: energy_office_desk
    unit_prefix: k
    round: 2 

sensor bill:
  - platform: template
    sensors:
      monthly_energy_cicle_days:
        value_template: >-
          {{ ( as_timestamp( now() ) - as_timestamp( states.sensor.monthly_energy.attributes.last_reset ) ) | timestamp_custom("%d") }}
      monthly_energy_cost:
        friendly_name: "Fatura Energia"
        value_template: >-
          {{ ( float(states.sensor.monthly_energy.state) * (0.1456+0.001) * 1.23 + float(states.sensor.monthly_energy_cicle_days.state) * 0.2292 * 1.23 + 2.85 * 1.06 ) | round(2) }}
        unit_of_measurement: "â‚¬"

  
