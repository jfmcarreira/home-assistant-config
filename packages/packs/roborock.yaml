
      
sensor:
  - platform: mqtt
    name: Roborock State
    state_topic: "valetudo/Roborock/state"
    value_template: "{{ value_json.state }}"
    json_attributes_topic: "valetudo/Roborock/state"
    json_attributes_template: "{{ {'Error message': value_json.error } | tojson }}"
        
  #- name: Roborock Map
    #platform: mqtt
    #state_topic: "valetudo/Roborock/state"
    #json_attributes_topic: "valetudo/Roborock/map_data_parsed"
    #value_template: 'OK'
    #scan_interval: 5
     

binary_sensor:
  - platform: template
    sensors:
      roborock_state:
        icon_template: mdi:robot-vacuum
        value_template: "{{ states.vacuum.roborock.state != 'docked' }}"  
        friendly_name: "Aspirador Roborock"
    
    
    
input_boolean:
  vacuum_livingroom:
    name: Sala de Estar
    icon: mdi:sofa
  vacuum_hallway:
    name: Corredor
    icon: mdi:door-open
  vacuum_kitchen:
    name: Cozinha
    icon: mdi:stove
  vacuum_office:
    name: Escrit√≥rio
    icon: mdi:desk
  vacuum_bathroom:
    name: Casa de Banho
    icon: mdi:toilet
  vacuum_bedroom:
    name: Quarto
    icon: mdi:bed-double
  vacuum_bedroombath:
    name: Casa de Banho do Quarto
    icon: mdi:shower-head
  vacuum_guestbedroom:
    name: Quarto do Fundo
    icon: mdi:bed-queen-outline
  vacuum_livingroomwithcarpet:
    name: Sala Com Tapetes (Zona)
    icon: mdi:sofa
    
automation old:
  # If You say "Clean $ ", then Make a web request
  # Body configured in IFTTT: { "action": "vacuum_room", "room":"{{TextField}}" }
  - alias: IFTTT Vacuum Room
    trigger:
      - event_data:
          action: vacuum_room
        event_type: ifttt_webhook_received
        platform: event
    action:
      - data_template:
          room: "{{ trigger.event.data.room }}"
          runs: 1
        service: python_script.vacuum_room

script:
  task_roborock_clean:
    alias: Task Roborock Cleaning
    sequence:
    
    ## For original firmware and xiaomi app
    ## Trial and error for the position
    #- service: vacuum.set_fan_speed
      #data:
        #entity_id: vacuum.roborock
        #fan_speed: "105"
    #- service: vacuum.send_command 
      #data:
        #command: app_goto_target
        #params:
        #- 26925
        #- 24435
      #entity_id: vacuum.roborock
    
    ## For valetudo app
    ## Position is configured within the webapp
    - service: vacuum.send_command
      entity_id: vacuum.roborock
      data:
        command: 'go_to'
        params:
          'spot_id': 'KitchenBin'
