automation:
  - id: "1701641659897"
    alias: Atualizar Localização Quando o Portão Abre
    mode: single
    trigger:
      - platform: state
        entity_id:
          - cover.gate
        to: opening
      - platform: state
        entity_id:
          - cover.gate
        to: open
    condition: []
    action:
      - if:
          - condition: state
            entity_id: binary_sensor.joao_home
            state: "off"
        then:
          - repeat:
              while: "{{ is_state('binary_sensor.joao_home', 'off') and repeat.index < 5 }}"
              sequence:
                - service: notify.mobile_app_magnesium
                  data:
                    message: request_location_update
                - delay:
                    seconds: 20
      - if:
          - condition: state
            entity_id: binary_sensor.bianca_home
            state: "off"
        then:
          - repeat:
              while: "{{ is_state('binary_sensor.bianca_home', 'off') and repeat.index < 5 }}"
              sequence:
                - service: notify.mobile_app_calcium
                  data:
                    message: request_location_update
                - delay:
                    seconds: 20
