input_datetime:
  heating_off_weekend_days:
    name: Horário Desligar Aquecimento - Dias Úteis
    has_date: false
    has_time: true
  heating_off_working_days:
    name: Horário Desligar Aquecimento - Fim de Semana
    has_date: false
    has_time: true

automation:
- id: Heating Auto Turn Off - Weekend
  alias: Heating Auto Turn Off - Weekend
  trigger:
    - platform: template
      value_template: "{{ states.sensor.time.state == (states.input_datetime.heating_off_weekend_days.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: template
      value_template: >
        {% if (states.input_datetime.heating_off_weekend_days.attributes.timestamp | int ) < 28800 %}
            {{ is_state('binary_sensor.workday', 'off') }}
        {% else %}
            {{ is_state('binary_sensor.workday_tomorrow', 'off') }}
        {% endif %}
  action:
    - service: climate.turn_off
      entity_id: climate.heating


- id: Heating Auto Turn Off - Working Days
  alias: Heating Auto Turn Off - Working Days
  trigger:
    - platform: template
      value_template: "{{ states.sensor.time.state == (states.input_datetime.heating_off_working_days.attributes.timestamp | int | timestamp_custom('%H:%M', False)) }}"
  condition:
    - condition: template
      value_template: >
        {% if (states.input_datetime.heating_off_working_days.attributes.timestamp | int ) < 28800 %}
            {{ is_state('binary_sensor.workday', 'on') }}
        {% else %}
            {{ is_state('binary_sensor.workday_tomorrow', 'on') }}
        {% endif %}
  action:
    - service: climate.turn_off
      entity_id: climate.heating
