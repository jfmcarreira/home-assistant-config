timer:
  office_desk_auto_off:
    duration: '00:05:00'

automation old:
  - alias: Lights Start Auto Off Timers on Startup
    description: ""
    trigger:
      - event: start
        platform: homeassistant
    condition: []
    action:
      - data: {}
        entity_id: timer.office_desk_auto_off
        service: timer.start
      - data: {}
        entity_id: timer.tv_leds_auto_off
        service: timer.start

  - alias: Lights Office Desk Auto On
    trigger:
      - entity_id: binary_sensor.motion_sensor_office
        from: "off"
        platform: state
        to: "on"
    condition:
      - condition: state
        entity_id: light.office
        state: "off"
      - condition: template
        value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
      - condition: or
        conditions:
          - condition: state
            entity_id: light.office_desk
            state: "off"
          - condition: state
            entity_id: timer.office_desk_auto_off
            state: active
    action:
      - data:
          duration: 00:05:00
        entity_id: timer.office_desk_auto_off
        service: timer.start
      - entity_id: light.office_desk
        service: light.turn_on

  - alias: Lights Office Desk Auto Off
    trigger:
      - platform: event
        event_type: timer.finished
        event_data:
          entity_id: timer.office_desk_auto_off
      
      - platform: state
        entity_id: light.office
        for: 00:00:10
        to: "off"
      - platform: state
        entity_id: light.office
        to: "on"
    action:
      - entity_id: light.office_desk
        service: light.turn_off

  - alias: Lights Office Desk When Off
    trigger:
      - entity_id: light.office_desk
        platform: state
        to: "off"
    action:
      - entity_id: timer.office_desk_auto_off
        service: timer.cancel
