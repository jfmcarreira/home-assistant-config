script:
  routine_leaving_and_coming_back:
    alias: Vou Ali e JÃ¡ Venho
    mode: single
    sequence:
      - variables:
          joao_was_home: "{{ is_state('binary_sensor.joao_home','on' ) }}"
          bianca_was_home: "{{ is_state('binary_sensor.bianca_home','on' ) }}"
      - service: script.sequence_door_open
        data: {}
      - condition: state
        entity_id: binary_sensor.joao_home
        state: "on"
      - service: cover.open_cover
        data: {}
        target:
          entity_id: cover.gate
      - wait_for_trigger:
          - platform: state
            entity_id:
              - binary_sensor.bianca_home
              - binary_sensor.joao_home
            to: "off"
            from: "on"
        timeout: 00:05:00
      - service: cover.close_cover
        data: {}
        target:
          entity_id: cover.gate
      - if:
          - condition: template
            value_template: "{{ joao_was_home }}"
          - condition: state
            entity_id: binary_sensor.joao_home
            state: "off"
        then:
          - service: input_boolean.turn_on
            data: {}
            target:
              entity_id: input_boolean.going_home_joao
      - if:
          - condition: template
            value_template: "{{ bianca_was_home }}"
          - condition: state
            entity_id: binary_sensor.bianca_home
            state: "off"
        then:
          - service: input_boolean.turn_on
            data: {}
            target:
              entity_id: input_boolean.going_home_bianca
