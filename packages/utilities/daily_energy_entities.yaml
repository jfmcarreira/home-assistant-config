################################################################
## Power Consumption
################################################################
homeassistant:
  customize:
    sensor.power_usage_lights:
      friendly_name: PotÃªncia Total das Luzes
  customize_glob:
    "sensor.power_usage_*":
      device_class: power
      icon: mdi:flash
      unit_of_measurement: "W"
    "sensor.power_sensor_*":
      device_class: power
      icon: mdi:flash
      unit_of_measurement: "W"
    "sensor.*_power":
      device_class: power
      icon: mdi:flash
      unit_of_measurement: "W"
    "sensor.power_sensor_*_reactive":
      device_class: power
      icon: mdi:flash-alert
      unit_of_measurement: "VAR"
    "sensor.*_energy":
      unit_of_measurement: "kWh"
    "sensor.energy_*":
      unit_of_measurement: "kWh"
    "sensor.daily_energy_*":
      unit_of_measurement: "kWh"

utility_meter: 
  daily_energy:
    source: sensor.pzem_energy
    cycle: daily
  daily_energy_living_room:
    source: sensor.energy_living_room
    cycle: daily
  daily_energy_laundry:
    source: sensor.energy_laundry
    cycle: daily
  daily_energy_lights:
    source: sensor.energy_lights
    cycle: daily

sensor power:
  - platform: template
    sensors:
      power_usage_lights:
        unit_of_measurement: "khW"
        value_template: >
         {{ (( 
            ( states.sensor.power_usage_light_bedroom_ricardo_lamp.state | float ) + 
            ( states.sensor.power_usage_light_kitchen.state | float ) + 
            ( states.sensor.power_usage_light_kitchen_pantry.state | float ) + 
            ( states.sensor.power_usage_light_living_room_abajur.state | float ) + 
            ( states.sensor.power_usage_light_living_room_table.state | float ) + 
            ( states.sensor.power_usage_light_living_room_window.state | float ) + 
            ( states.sensor.power_usage_light_master_bedroom.state | float ) + 
            ( states.sensor.power_usage_light_master_bedroom_bathroom.state | float ) + 
            ( states.sensor.power_usage_light_hallway.state | float ) + 
            ( states.sensor.power_usage_light_front_door.state | float ) 
            ) * 100 | int | float ) / 100
           }}
         
        #( states.sensor.power_usage_light_living_room_tv_leds.state | float )+ ( states.sensor.power_usage_light_office_desk.state | float )
        
sensor energy: 
  - platform: integration
    source: sensor.power_sensor_living_room
    name: energy_living_room
    unit_prefix: k
    unit_time: h
    round: 2
  
  - platform: integration
    source: sensor.power_sensor_laundry
    name: energy_laundry
    unit_prefix: k
    unit_time: h
    round: 2 
  
  - platform: integration
    source: sensor.power_usage_lights
    name: energy_lights
    unit_prefix: k
    unit_time: h
    round: 2 

    
  - platform: template
    sensors:
      daily_energy_remaining:
        unit_of_measurement: "khW"
        value_template: >
          {{ 
            ( states.sensor.daily_energy.state | float ) - 
            ( states.sensor.daily_energy_living_room.state | float ) - 
            ( states.sensor.daily_energy_lights.state | float ) - 
            ( states.sensor.daily_energy_washing_machine.state | float ) - 
            ( states.sensor.daily_energy_dish_wash_machine.state | float ) - 
            ( states.sensor.daily_energy_fridge.state | float ) -   
            ( states.sensor.daily_energy_iron.state | float ) - 
            ( states.sensor.daily_energy_portable_heater.state | float )
          }}
          
#( states.sensor.daily_energy_laundry.state | float ) - 
#( states.sensor.daily_energy_office_desk.state | float ) - 

 
