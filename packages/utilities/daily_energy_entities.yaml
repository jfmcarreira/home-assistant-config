################################################################
## Power Consumption
################################################################
homeassistant:
  customize:
    sensor.power_usage_lights:
      friendly_name: Potência Total das Luzes
    sensor.daily_energy_coffe_machine:
      friendly_name: Máquina do Café
    sensor.daily_energy_office_desk:
      friendly_name: Secretária do Escritório
    sensor.daily_energy_server:
      friendly_name: Servidor
    sensor.daily_energy_laundry:
      friendly_name: Sótão
    sensor.daily_energy_kitchen_oven:
      friendly_name: Forno/Fogão
    sensor.daily_energy_media_center:
      friendly_name: Centro Multimédia
    sensor.daily_energy_lights:
      friendly_name: Luzes
  customize_glob:
    "sensor.reative_power_usage_device_*":
      device_class: power
      unit_of_measurement: "VAR"
      icon: mdi:flash-outline
    "sensor.power_usage_reactive_*":
      device_class: power
      unit_of_measurement: "VAR"
      icon: mdi:flash-outline
    "sensor.power_usage_*":
      device_class: power
      unit_of_measurement: "W"
      icon: mdi:flash
    "sensor.daily_energy_*":
      icon: mdi:flash-circle
      unit_of_measurement: "kWh"
    "sensor.energy_*":
      icon: mdi:flash-circle

utility_meter:
  daily_energy:
    source: sensor.bhpzem_energy
    cycle: daily
  #daily_energy_living_room:
  #source: sensor.living_room_energy
  #cycle: daily
  daily_energy_laundry:
    source: sensor.energy_laundry
    cycle: daily
  daily_energy_kitchen_oven:
    source: sensor.kitchen_oven_energy
    cycle: daily
  daily_energy_coffe_machine:
    source: sensor.energy_coffe_machine
    cycle: daily
  daily_energy_office_desk:
    source: sensor.energy_office_desk
    cycle: daily
  daily_energy_server:
    source: sensor.energy_server
    cycle: daily
  daily_energy_media_center:
    source: sensor.energy_media_center
    cycle: daily
  daily_energy_lights:
    source: sensor.energy_lights
    cycle: daily

sensor:
  - platform: template
    sensors:
      power_usage_laundry:
        unit_of_measurement: "W"
        value_template: >
          {{ ( states('sensor.power_usage_laundry_main') | float ) - ( states('sensor.power_usage_device_washing_machine') | float ) }}

      power_usage_lights:
        unit_of_measurement: "W"
        value_template: >
          {{ ((
            ( states('sensor.power_usage_light_kitchen') | float ) +
            ( states('sensor.power_usage_light_kitchen_pantry') | float ) +
            ( states('sensor.power_usage_light_living_room_table') | float ) +
            ( states('sensor.power_usage_light_living_room_window') | float ) +
            ( states('sensor.power_usage_light_master_bedroom') | float ) +
            ( states('sensor.power_usage_light_master_bedroom_bathroom_ceiling') | float ) +
            ( states('sensor.power_usage_light_master_bedroom_bathroom_mirror') | float ) +
            ( states('sensor.power_usage_light_hallway') | float ) +
            ( states('sensor.power_usage_light_front_door') | float ) +
            ( states('sensor.power_usage_light_ricardo_lamp') | float )
            ) | int )
          }}

      daily_energy_remaining:
        unit_of_measurement: "kWh"
        value_template: >
          {{
            (
              ( states('sensor.daily_energy') | float ) -
              ( states('sensor.daily_energy_media_center') | float ) -
              ( states('sensor.daily_energy_server') | float ) -
              ( states('sensor.daily_energy_office_desk') | float ) -
              ( states('sensor.daily_energy_kitchen_oven') | float ) -
              ( states('sensor.daily_energy_microwave') | float ) -
              ( states('sensor.daily_energy_coffe_machine') | float ) -
              ( states('sensor.daily_energy_washing_machine') | float ) -
              ( states('sensor.daily_energy_dish_wash_machine') | float ) -
              ( states('sensor.daily_energy_fridge') | float ) -
              ( states('sensor.daily_energy_laundry') | float ) -
              ( states('sensor.daily_energy_iron') | float ) -
              ( states('sensor.daily_energy_portable_heater') | float ) -
              ( states('sensor.daily_energy_lights') | float )
            ) | round(3)
          }}

  - platform: integration
    source: sensor.power_usage_laundry
    name: energy_laundry
    unit_prefix: k
    unit_time: h
    round: 2

  - platform: integration
    source: sensor.power_usage_device_coffe_machine
    name: energy_coffe_machine
    unit_prefix: k
    unit_time: h
    round: 2

  - platform: integration
    source: sensor.power_usage_device_server
    name: energy_server
    unit_prefix: k
    unit_time: h
    round: 2

  - platform: integration
    source: sensor.power_usage_device_office_desk
    name: energy_office_desk
    unit_prefix: k
    unit_time: h
    round: 2

  - platform: integration
    source: sensor.power_usage_lights
    name: energy_lights
    unit_prefix: k
    unit_time: h
    round: 2

automation insert:
  - alias: "Daily Stats Insert Value of Partial Energy of to Database"
    initial_state: true
    mode: queued
    max: 20
    trigger:
      - platform: state
        entity_id: sensor.daily_energy
      - platform: state
        entity_id: sensor.daily_energy_living_room
      - platform: state
        entity_id: sensor.daily_energy_media_center
      - platform: state
        entity_id: sensor.daily_energy_laundry
      - platform: state
        entity_id: sensor.daily_energy_kitchen_oven
      - platform: state
        entity_id: sensor.daily_energy_coffe_machine
      - platform: state
        entity_id: sensor.daily_energy_microwave
      - platform: state
        entity_id: sensor.daily_energy_dish_wash_machine
      - platform: state
        entity_id: sensor.daily_energy_washing_machine
      - platform: state
        entity_id: sensor.daily_energy_fridge
      - platform: state
        entity_id: sensor.daily_energy_office_desk
      - platform: state
        entity_id: sensor.daily_energy_iron
      - platform: state
        entity_id: sensor.daily_energy_portable_heater
      - platform: state
        entity_id: sensor.daily_energy_lights
      - platform: state
        entity_id: sensor.daily_energy_server
      - platform: state
        entity_id: sensor.daily_energy_remaining
    action:
      - service: shell_command.external_my_sql_insert
        data_template:
          table: daily_energy_partial
          value: >
            {{ trigger.to_state.state }}
          column: >
            {% if trigger.entity_id == "sensor.daily_energy" %}
              daily_energy_total
            {% elif trigger.entity_id == "sensor.daily_energy_living_room" %}
              daily_energy_living_room
            {% elif trigger.entity_id == "sensor.daily_energy_media_center" %}
              daily_energy_media_center
            {% elif trigger.entity_id == "sensor.daily_energy_laundry" %}
              daily_energy_laundry
            {% elif trigger.entity_id == "sensor.daily_energy_kitchen_oven" %}
              daily_energy_kitchen_oven
            {% elif trigger.entity_id == "sensor.daily_energy_coffe_machine" %}
              daily_energy_coffe_machine
            {% elif trigger.entity_id == "sensor.daily_energy_microwave" %}
              daily_energy_microwave
            {% elif trigger.entity_id == "sensor.daily_energy_dish_wash_machine" %}
              daily_energy_dish_wash_machine
            {% elif trigger.entity_id == "sensor.daily_energy_washing_machine" %}
              daily_energy_washing_machine
            {% elif trigger.entity_id == "sensor.daily_energy_fridge" %}
              daily_energy_fridge
            {% elif trigger.entity_id == "sensor.daily_energy_office_desk" %}
              daily_energy_office_desk
            {% elif trigger.entity_id == "sensor.daily_energy_iron" %}
              daily_energy_iron
            {% elif trigger.entity_id == "sensor.daily_energy_portable_heater" %}
              daily_energy_portable_heater
            {% elif trigger.entity_id == "sensor.daily_energy_lights" %}
              daily_energy_lights
            {% elif trigger.entity_id == "sensor.daily_energy_server" %}
              daily_energy_server
            {% elif trigger.entity_id == "sensor.daily_energy_remaining" %}
              daily_energy_remaining
            {% endif %}
